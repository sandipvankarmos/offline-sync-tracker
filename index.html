<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>myWork.AI - Offline Task Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    },
                    colors: {
                        brand: {
                            50: '#ecfeff',
                            100: '#cffafe',
                            200: '#a5f3fc',
                            300: '#67e8f9',
                            400: '#22d3ee',
                            500: '#06b6d4',
                            600: '#0891b2',
                            700: '#0e7490',
                            800: '#155e75',
                            900: '#164e63',
                            950: '#083344'
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .chart-container { position: relative; width: 100%; max-width: 500px; margin: 0 auto; height: 280px; }
        .phase-card { transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .phase-card:hover { transform: translateY(-2px); }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 10px; }
        .dark .custom-scroll::-webkit-scrollbar-thumb { background-color: #475569; }
        .toast-enter { animation: slideIn 0.3s ease forwards; }
        .toast-exit { animation: slideOut 0.3s ease forwards; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
        .modal-backdrop { animation: fadeIn 0.2s ease; }
        .modal-content { animation: scaleIn 0.2s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes scaleIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .priority-high { background: linear-gradient(135deg, #fef2f2, #fee2e2); border-left: 3px solid #ef4444; }
        .priority-medium { background: linear-gradient(135deg, #fffbeb, #fef3c7); border-left: 3px solid #f59e0b; }
        .priority-low { background: linear-gradient(135deg, #ecfeff, #cffafe); border-left: 3px solid #06b6d4; }
        .dark .priority-high { background: linear-gradient(135deg, #450a0a, #7f1d1d); }
        .dark .priority-medium { background: linear-gradient(135deg, #451a03, #78350f); }
        .dark .priority-low { background: linear-gradient(135deg, #083344, #164e63); }
        .brand-gradient { background: linear-gradient(135deg, #0ea5e9, #06b6d4, #14b8a6); }
        .brand-gradient-text { background: linear-gradient(135deg, #0ea5e9, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .decorative-circle { position: absolute; border-radius: 50%; opacity: 0.5; pointer-events: none; }
        /* Notification Panel Styles */
        .notification-panel { animation: slideDown 0.3s ease; }
        @keyframes slideDown { from { transform: translateY(-10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .notification-item { animation: fadeInUp 0.3s ease forwards; opacity: 0; }
        .notification-item:nth-child(1) { animation-delay: 0.1s; }
        .notification-item:nth-child(2) { animation-delay: 0.2s; }
        .notification-item:nth-child(3) { animation-delay: 0.3s; }
        @keyframes fadeInUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .notification-badge { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .welcome-modal { animation: bounceIn 0.5s ease; }
        @keyframes bounceIn { 0% { transform: scale(0.3) translate(-50%, -50%); opacity: 0; } 50% { transform: scale(1.05) translate(-50%, -50%); } 70% { transform: scale(0.95) translate(-50%, -50%); } 100% { transform: scale(1) translate(-50%, -50%); opacity: 1; } }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-cyan-50/30 to-slate-50 dark:from-slate-900 dark:via-slate-900 dark:to-slate-900 text-slate-900 dark:text-slate-100 transition-colors duration-300 pb-24 relative overflow-x-hidden">

    <!-- Decorative Background Circles (matching myWork app) -->
    <div class="decorative-circle w-32 h-32 bg-cyan-200 dark:bg-cyan-900/30 top-20 -left-10 fixed"></div>
    <div class="decorative-circle w-24 h-24 bg-teal-200 dark:bg-teal-900/30 top-40 right-10 fixed"></div>
    <div class="decorative-circle w-16 h-16 bg-amber-200 dark:bg-amber-900/30 top-32 left-1/4 fixed"></div>
    <div class="decorative-circle w-20 h-20 bg-cyan-100 dark:bg-cyan-900/20 bottom-40 right-1/4 fixed"></div>
    <div class="decorative-circle w-12 h-12 bg-purple-200 dark:bg-purple-900/30 top-60 right-1/3 fixed"></div>

    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Notification Panel -->
    <div id="notificationPanel" class="fixed top-16 right-4 w-80 max-w-[calc(100vw-2rem)] z-50 hidden">
        <div class="notification-panel bg-white dark:bg-slate-800 rounded-2xl shadow-2xl border border-slate-200 dark:border-slate-700 overflow-hidden">
            <div class="p-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                <h3 class="font-bold text-slate-800 dark:text-white flex items-center gap-2">
                    <svg class="w-5 h-5 text-cyan-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                    </svg>
                    Notifications
                </h3>
                <button onclick="clearAllNotifications()" class="text-xs text-cyan-600 dark:text-cyan-400 hover:underline font-medium">Clear all</button>
            </div>
            <div id="notificationList" class="max-h-80 overflow-y-auto custom-scroll">
                <!-- Notifications will be injected here -->
            </div>
            <div id="noNotifications" class="p-8 text-center hidden">
                <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center">
                    <svg class="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <p class="text-sm text-slate-500 dark:text-slate-400">All caught up!</p>
            </div>
        </div>
    </div>

    <!-- Welcome Modal -->
    <div id="welcomeModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeWelcomeModal()"></div>
        <div class="welcome-modal absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md mx-4">
            <div class="bg-white dark:bg-slate-800 rounded-3xl shadow-2xl border border-slate-200 dark:border-slate-700 overflow-hidden">
                <div class="bg-gradient-to-r from-cyan-500 to-teal-500 p-6 text-white text-center">
                    <div class="w-16 h-16 mx-auto mb-4 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold mb-1">Welcome to myWork.AI</h2>
                    <p class="text-white/80 text-sm">Your offline-first task tracker</p>
                </div>
                <div class="p-6">
                    <div id="welcomeContent" class="space-y-4">
                        <!-- Dynamic welcome content -->
                    </div>
                    <button onclick="closeWelcomeModal()" class="w-full mt-6 px-4 py-3 bg-gradient-to-r from-cyan-500 to-teal-500 text-white rounded-xl font-semibold text-sm hover:from-cyan-600 hover:to-teal-600 transition-all shadow-lg shadow-cyan-500/25">
                        Get Started
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white/80 dark:bg-slate-900/90 backdrop-blur-xl border-b border-slate-200/50 dark:border-slate-700/50 py-4 shadow-sm sticky top-0 z-40">
        <div class="container mx-auto px-4 md:px-6">
            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                <div class="flex items-center gap-4 w-full lg:w-auto justify-between">
                    <div class="flex items-center gap-3">
                        <!-- myWork Logo -->
                        <div class="w-10 h-10 relative">
                            <svg viewBox="0 0 100 100" class="w-full h-full">
                                <!-- Heart-infinity logo inspired by myWork -->
                                <defs>
                                    <linearGradient id="brandGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#0ea5e9"/>
                                        <stop offset="50%" style="stop-color:#06b6d4"/>
                                        <stop offset="100%" style="stop-color:#14b8a6"/>
                                    </linearGradient>
                                </defs>
                                <path d="M50 85 C20 60, 10 35, 30 20 C45 10, 50 25, 50 35 C50 25, 55 10, 70 20 C90 35, 80 60, 50 85" 
                                      fill="none" stroke="url(#brandGradient)" stroke-width="6" stroke-linecap="round"/>
                                <circle cx="30" cy="25" r="4" fill="#0ea5e9"/>
                                <circle cx="70" cy="25" r="4" fill="#14b8a6"/>
                                <circle cx="50" cy="40" r="3" fill="#06b6d4"/>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-2xl md:text-2xl font-bold tracking-tight text-slate-800 dark:text-white">my<span class="brand-gradient-text">Work</span><span class="text-slate-400 dark:text-slate-500 font-normal">.AI</span></h1>
                            <p class="text-slate-500 dark:text-slate-400 text-xs font-medium hidden sm:block">Offline-First Task Tracker</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 lg:hidden">
                        <!-- Mobile: Online Status -->
                        <div id="onlineStatusMobile" class="flex items-center gap-1.5 px-2 py-1 rounded-full text-[10px] font-bold uppercase bg-teal-500/20 text-teal-600 dark:text-teal-400">
                            <span class="w-1.5 h-1.5 rounded-full bg-teal-500 animate-pulse"></span>
                            <span>Online</span>
                        </div>
                        <!-- Mobile: Notification Bell -->
                        <button onclick="toggleNotificationPanel()" class="p-2 rounded-xl bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors text-slate-600 dark:text-slate-300 relative" id="notificationBellMobile">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                            </svg>
                            <span id="notificationBadgeMobile" class="notification-badge absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-[9px] font-bold rounded-full flex items-center justify-center hidden">0</span>
                        </button>
                        <!-- Mobile: Dark Mode Toggle -->
                        <button onclick="toggleDarkMode()" class="p-2 rounded-xl bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors text-slate-600 dark:text-slate-300">
                            <svg id="darkIconMobile" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                            </svg>
                            <svg id="lightIconMobile" class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Search Bar -->
                <div class="flex-1 max-w-md w-full">
                    <div class="relative">
                        <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <input type="text" id="searchInput" placeholder="Search tasks... (Ctrl+K)" 
                               class="w-full pl-10 pr-4 py-2.5 bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-sm text-slate-800 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all"
                               oninput="handleSearch(this.value)">
                        <kbd class="absolute right-3 top-1/2 -translate-y-1/2 hidden sm:inline-flex items-center px-2 py-0.5 text-[10px] font-mono text-slate-400 bg-slate-200 dark:bg-slate-700 rounded">âŒ˜K</kbd>
                    </div>
                </div>

                <!-- Desktop Controls -->
                <div class="hidden lg:flex items-center gap-3">
                    <!-- Online Status -->
                    <div id="onlineStatus" class="flex items-center gap-1.5 px-3 py-1.5 rounded-full text-[10px] font-bold uppercase bg-teal-500/20 text-teal-600 dark:text-teal-400">
                        <span class="w-1.5 h-1.5 rounded-full bg-teal-500 animate-pulse"></span>
                        <span>Online</span>
                    </div>
                    
                    <!-- Notification Bell -->
                    <button onclick="toggleNotificationPanel()" class="p-2.5 rounded-xl bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors text-slate-600 dark:text-slate-300 relative" title="Notifications" id="notificationBellDesktop">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                        </svg>
                        <span id="notificationBadgeDesktop" class="notification-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center hidden">0</span>
                    </button>

                    <!-- Dark Mode Toggle -->
                    <button onclick="toggleDarkMode()" class="p-2.5 rounded-xl bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors text-slate-600 dark:text-slate-300" title="Toggle Dark Mode">
                        <svg id="darkIcon" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                        <svg id="lightIcon" class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </button>

                    <!-- Stats -->
                    <div class="flex gap-2">
                        <div class="bg-gradient-to-br from-cyan-500 to-teal-500 px-4 py-2 rounded-xl text-center text-white shadow-lg shadow-cyan-500/25">
                            <div id="totalProgressText" class="text-xl font-bold">0%</div>
                            <div class="text-[9px] uppercase tracking-widest opacity-80 font-bold">Complete</div>
                        </div>
                        <div class="bg-white dark:bg-slate-800 px-4 py-2 rounded-xl border border-slate-200 dark:border-slate-700 text-center">
                            <div id="totalHoursText" class="text-xl font-bold text-cyan-600 dark:text-cyan-400">0</div>
                            <div class="text-[9px] uppercase tracking-widest text-slate-500 font-bold">Hours Left</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile Stats Row -->
            <div class="flex lg:hidden gap-2 mt-4">
                <div class="flex-1 bg-gradient-to-br from-cyan-500 to-teal-500 px-3 py-2 rounded-xl text-center text-white shadow-lg shadow-cyan-500/25">
                    <div id="totalProgressTextMobile" class="text-lg font-bold">0%</div>
                    <div class="text-[8px] uppercase tracking-widest opacity-80 font-bold">Complete</div>
                </div>
                <div class="flex-1 bg-white dark:bg-slate-800 px-3 py-2 rounded-xl border border-slate-200 dark:border-slate-700 text-center">
                    <div id="totalHoursTextMobile" class="text-lg font-bold text-cyan-600 dark:text-cyan-400">0</div>
                    <div class="text-[8px] uppercase tracking-widest text-slate-500 font-bold">Hours Left</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Dashboard Content -->
    <main class="container mx-auto px-4 md:px-6 py-6">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- Sidebar: Analytics & Filters -->
            <div class="lg:col-span-4 xl:col-span-3 space-y-6">
                <!-- Chart -->
                <div class="bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm p-5 rounded-2xl shadow-sm border border-slate-200/50 dark:border-slate-700/50">
                    <h2 class="text-sm font-bold mb-4 flex items-center gap-2 text-slate-700 dark:text-slate-200">
                        <span class="w-2 h-2 bg-gradient-to-r from-cyan-500 to-teal-500 rounded-full"></span> Effort Distribution
                    </h2>
                    <div class="chart-container">
                        <canvas id="effortChart"></canvas>
                    </div>
                </div>

                <!-- Filters -->
                <div class="bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm p-5 rounded-2xl shadow-sm border border-slate-200/50 dark:border-slate-700/50">
                    <h2 class="text-sm font-bold mb-4 flex items-center gap-2 text-slate-700 dark:text-slate-200">
                        <svg class="w-4 h-4 text-cyan-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                        </svg>
                        Filters
                    </h2>
                    <div class="space-y-3">
                        <div>
                            <label class="text-[10px] uppercase tracking-wider font-bold text-slate-500 dark:text-slate-400 mb-1 block">Status</label>
                            <select id="filterStatus" onchange="applyFilters()" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500">
                                <option value="all">All Tasks</option>
                                <option value="pending">Pending</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-[10px] uppercase tracking-wider font-bold text-slate-500 dark:text-slate-400 mb-1 block">Priority</label>
                            <select id="filterPriority" onchange="applyFilters()" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500">
                                <option value="all">All Priorities</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                        <button onclick="clearFilters()" class="w-full px-3 py-2 text-xs font-semibold text-cyan-600 dark:text-cyan-400 hover:bg-cyan-50 dark:hover:bg-cyan-900/20 rounded-xl transition-colors border border-cyan-200 dark:border-cyan-800">
                            Clear Filters
                        </button>
                    </div>
                </div>

                <!-- Phase Progress -->
                <div class="bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm p-5 rounded-2xl shadow-sm border border-slate-200/50 dark:border-slate-700/50">
                    <h2 class="text-sm font-bold mb-4 text-slate-700 dark:text-slate-200">Phase Progress</h2>
                    <div id="phaseProgressList" class="space-y-3">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </div>

            <!-- Main: Task Board -->
            <div class="lg:col-span-8 xl:col-span-9">
                <!-- Phase Tabs -->
                <div class="flex flex-wrap gap-2 mb-4" id="phaseTabs">
                    <button onclick="switchPhase('all')" data-phase="all" class="phase-tab px-4 py-2 rounded-xl bg-gradient-to-r from-cyan-500 to-teal-500 text-white font-semibold text-sm shadow-lg shadow-cyan-500/25 transition-all">All</button>
                    <button onclick="switchPhase(1)" data-phase="1" class="phase-tab px-4 py-2 rounded-xl bg-white/80 dark:bg-slate-800/80 text-slate-600 dark:text-slate-300 font-semibold text-sm border border-slate-200 dark:border-slate-700 hover:bg-cyan-50 dark:hover:bg-slate-700 hover:border-cyan-300 dark:hover:border-cyan-700 transition-all">Phase 1</button>
                    <button onclick="switchPhase(2)" data-phase="2" class="phase-tab px-4 py-2 rounded-xl bg-white/80 dark:bg-slate-800/80 text-slate-600 dark:text-slate-300 font-semibold text-sm border border-slate-200 dark:border-slate-700 hover:bg-cyan-50 dark:hover:bg-slate-700 hover:border-cyan-300 dark:hover:border-cyan-700 transition-all">Phase 2</button>
                    <button onclick="switchPhase(3)" data-phase="3" class="phase-tab px-4 py-2 rounded-xl bg-white/80 dark:bg-slate-800/80 text-slate-600 dark:text-slate-300 font-semibold text-sm border border-slate-200 dark:border-slate-700 hover:bg-cyan-50 dark:hover:bg-slate-700 hover:border-cyan-300 dark:hover:border-cyan-700 transition-all">Phase 3</button>
                    <button onclick="switchPhase(4)" data-phase="4" class="phase-tab px-4 py-2 rounded-xl bg-white/80 dark:bg-slate-800/80 text-slate-600 dark:text-slate-300 font-semibold text-sm border border-slate-200 dark:border-slate-700 hover:bg-cyan-50 dark:hover:bg-slate-700 hover:border-cyan-300 dark:hover:border-cyan-700 transition-all">Phase 4</button>
                    <button onclick="switchPhase(5)" data-phase="5" class="phase-tab px-4 py-2 rounded-xl bg-white/80 dark:bg-slate-800/80 text-slate-600 dark:text-slate-300 font-semibold text-sm border border-slate-200 dark:border-slate-700 hover:bg-cyan-50 dark:hover:bg-slate-700 hover:border-cyan-300 dark:hover:border-cyan-700 transition-all">Phase 5</button>
                </div>

                <!-- Task List -->
                <div id="taskContainer" class="space-y-3 max-h-[calc(100vh-300px)] overflow-y-auto custom-scroll pr-1">
                    <!-- Tasks injected here -->
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="hidden flex-col items-center justify-center py-16 text-center">
                    <div class="w-24 h-24 mb-6 rounded-full bg-gradient-to-br from-cyan-100 to-teal-100 dark:from-cyan-900/30 dark:to-teal-900/30 flex items-center justify-center">
                        <svg class="w-12 h-12 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                        </svg>
                    </div>
                    <h3 class="text-lg font-bold text-slate-700 dark:text-slate-300 mb-2">No tasks found</h3>
                    <p class="text-sm text-slate-500 dark:text-slate-400 mb-4">Try adjusting your filters or add a new task</p>
                    <button onclick="openAddModal()" class="px-6 py-2.5 bg-gradient-to-r from-cyan-500 to-teal-500 text-white rounded-xl font-semibold text-sm hover:from-cyan-600 hover:to-teal-600 transition-all shadow-lg shadow-cyan-500/25">
                        Add Task
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Floating Action Button -->
    <button onclick="openAddModal()" class="fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-r from-cyan-500 to-teal-500 hover:from-cyan-600 hover:to-teal-600 text-white rounded-full shadow-lg shadow-cyan-500/30 hover:shadow-xl hover:shadow-cyan-500/40 transition-all flex items-center justify-center group z-30" title="Add Task (N)">
        <svg class="w-6 h-6 group-hover:rotate-90 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
    </button>

    <!-- Add/Edit Task Modal -->
    <div id="taskModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-backdrop absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="modal-content absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg mx-4">
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl border border-slate-200 dark:border-slate-700 overflow-hidden">
                <div class="p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                    <h3 id="modalTitle" class="text-lg font-bold text-slate-800 dark:text-white">Add New Task</h3>
                    <button onclick="closeModal()" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors">
                        <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <form id="taskForm" onsubmit="handleTaskSubmit(event)" class="p-6 space-y-4">
                    <input type="hidden" id="taskId">
                    <div>
                        <label class="text-xs uppercase tracking-wider font-bold text-slate-500 dark:text-slate-400 mb-1.5 block">Task Name *</label>
                        <input type="text" id="taskText" required placeholder="Enter task description..."
                               class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 dark:text-white">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs uppercase tracking-wider font-bold text-slate-500 dark:text-slate-400 mb-1.5 block">Phase *</label>
                            <select id="taskPhase" required class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 dark:text-white">
                                <option value="1">Phase 1</option>
                                <option value="2">Phase 2</option>
                                <option value="3">Phase 3</option>
                                <option value="4">Phase 4</option>
                                <option value="5">Phase 5</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs uppercase tracking-wider font-bold text-slate-500 dark:text-slate-400 mb-1.5 block">Priority *</label>
                            <select id="taskPriority" required class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 dark:text-white">
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs uppercase tracking-wider font-bold text-slate-500 dark:text-slate-400 mb-1.5 block">File Reference</label>
                            <input type="text" id="taskFile" placeholder="e.g., App.swift"
                                   class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl text-sm font-mono focus:outline-none focus:ring-2 focus:ring-cyan-500 dark:text-white">
                        </div>
                        <div>
                            <label class="text-xs uppercase tracking-wider font-bold text-slate-500 dark:text-slate-400 mb-1.5 block">Effort (hours) *</label>
                            <input type="number" id="taskEffort" required min="0.5" step="0.5" value="1"
                                   class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 dark:text-white">
                        </div>
                    </div>
                    <div class="flex gap-3 pt-4">
                        <button type="button" onclick="closeModal()" class="flex-1 px-4 py-3 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-xl font-semibold text-sm hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors border border-slate-200 dark:border-slate-600">
                            Cancel
                        </button>
                        <button type="submit" class="flex-1 px-4 py-3 bg-gradient-to-r from-cyan-500 to-teal-500 text-white rounded-xl font-semibold text-sm hover:from-cyan-600 hover:to-teal-600 transition-all shadow-lg shadow-cyan-500/25">
                            Save Task
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-backdrop absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeDeleteModal()"></div>
        <div class="modal-content absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-sm mx-4">
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl border border-slate-200 dark:border-slate-700 p-6 text-center">
                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center">
                    <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-2">Delete Task?</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-6">This action cannot be undone.</p>
                <div class="flex gap-3">
                    <button onclick="closeDeleteModal()" class="flex-1 px-4 py-3 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-xl font-semibold text-sm hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">
                        Cancel
                    </button>
                    <button onclick="confirmDelete()" class="flex-1 px-4 py-3 bg-red-500 text-white rounded-xl font-semibold text-sm hover:bg-red-600 transition-colors">
                        Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== STATE MANAGEMENT =====
        const STORAGE_KEY = 'myWorkTasks';
        const THEME_KEY = 'myWorkTheme';
        
        let state = {
            tasks: [],
            filters: { search: '', status: 'all', priority: 'all', phase: 'all' },
            activePhase: 'all',
            editingTaskId: null,
            deleteTaskId: null
        };

        let chartInstance = null;

        // ===== DEFAULT TASKS =====
        const defaultTasks = [
            // Phase 1
            { id: "1.1", phase: 1, text: "Create OperationTracker.swift class", file: "New file", effort: 2, status: false, priority: "high", createdAt: Date.now() },
            { id: "1.2", phase: 1, text: "Add idempotency check in api_CollectSpecimen()", file: "SpecimenCollectionVC.swift", effort: 1, status: false, priority: "high", createdAt: Date.now() },
            { id: "1.3", phase: 1, text: "Add idempotency check in api_ReceiveSpecimen()", file: "SpecimenCollectionVC.swift", effort: 1, status: false, priority: "medium", createdAt: Date.now() },
            { id: "1.4", phase: 1, text: "Add idempotency check in api_SetTrip_Status()", file: "SpecimenCollectionVC.swift", effort: 0.5, status: false, priority: "medium", createdAt: Date.now() },
            { id: "1.5", phase: 1, text: "Add idempotency in api_CollectSpecimen()", file: "DigitalSignatureVC.swift", effort: 1, status: false, priority: "high", createdAt: Date.now() },
            { id: "1.6", phase: 1, text: "Add idempotency in api_SetTrip_Status()", file: "DigitalSignatureVC.swift", effort: 0.5, status: false, priority: "medium", createdAt: Date.now() },
            { id: "1.7", phase: 1, text: "Add idempotency in api_SetTrip_Status() (START/ARRIVED)", file: "MapVC.swift", effort: 1, status: false, priority: "medium", createdAt: Date.now() },
            { id: "1.8", phase: 1, text: "Remove duplicate token validation in viewDidLoad", file: "All VCs (15+ files)", effort: 2, status: false, priority: "low", createdAt: Date.now() },
            { id: "1.9", phase: 1, text: "Remove duplicate token validation in viewDidLayoutSubviews", file: "All VCs", effort: 1, status: false, priority: "low", createdAt: Date.now() },
            { id: "1.10", phase: 1, text: "Add GETRequestWithRetry() method", file: "ApiManager.swift", effort: 2, status: false, priority: "high", createdAt: Date.now() },
            { id: "1.11", phase: 1, text: "Update critical APIs to use retry method", file: "ApiManager.swift", effort: 1, status: false, priority: "medium", createdAt: Date.now() },
            // Phase 2
            { id: "2.1", phase: 2, text: "Create NetworkSpeedMonitor.swift class", file: "New file", effort: 4, status: false, priority: "high", createdAt: Date.now() },
            { id: "2.2", phase: 2, text: "Add speed check before specimen collection", file: "SpecimenCollectionVC.swift", effort: 0.5, status: false, priority: "medium", createdAt: Date.now() },
            { id: "2.3", phase: 2, text: "Add speed check before signature upload", file: "DigitalSignatureVC.swift", effort: 0.5, status: false, priority: "medium", createdAt: Date.now() },
            { id: "2.4", phase: 2, text: "Add speed check before trip status update", file: "MapVC.swift", effort: 0.5, status: false, priority: "medium", createdAt: Date.now() },
            { id: "2.5", phase: 2, text: "Create slow network alert dialog", file: "NetworkSpeedMonitor.swift", effort: 1, status: false, priority: "medium", createdAt: Date.now() },
            { id: "2.6", phase: 2, text: "Create offline alert dialog", file: "NetworkSpeedMonitor.swift", effort: 1, status: false, priority: "high", createdAt: Date.now() },
            { id: "2.7", phase: 2, text: "Adjust API timeout based on network speed", file: "ApiManager.swift", effort: 1, status: false, priority: "medium", createdAt: Date.now() },
            { id: "2.8", phase: 2, text: "Add 'Pending Sync' badge/indicator in UI", file: "MyAppointmentVC.swift", effort: 2, status: false, priority: "high", createdAt: Date.now() },
            // Phase 3
            { id: "3.1", phase: 3, text: "Create OfflineOperationQueue.swift class", file: "New file", effort: 4, status: false, priority: "high", createdAt: Date.now() },
            { id: "3.2", phase: 3, text: "Create PendingOperation model", file: "OfflineOperationQueue.swift", effort: 1, status: false, priority: "high", createdAt: Date.now() },
            { id: "3.3", phase: 3, text: "Implement queue persistence (UserDefaults/CoreData)", file: "OfflineOperationQueue.swift", effort: 1, status: false, priority: "high", createdAt: Date.now() },
            { id: "3.4", phase: 3, text: "Integrate offline queue in api_CollectSpecimen()", file: "SpecimenCollectionVC.swift", effort: 1, status: false, priority: "medium", createdAt: Date.now() },
            { id: "3.5", phase: 3, text: "Integrate offline queue in api_ReceiveSpecimen()", file: "SpecimenCollectionVC.swift", effort: 1, status: false, priority: "medium", createdAt: Date.now() },
            { id: "3.6", phase: 3, text: "Integrate offline queue in api_SetTrip_Status()", file: "MapVC.swift", effort: 1, status: false, priority: "medium", createdAt: Date.now() },
            { id: "3.7", phase: 3, text: "Integrate offline queue in signature upload", file: "DigitalSignatureVC.swift", effort: 1, status: false, priority: "medium", createdAt: Date.now() },
            { id: "3.8", phase: 3, text: "Add local trip caching (CoreData model)", file: "CoreData model", effort: 4, status: false, priority: "high", createdAt: Date.now() },
            { id: "3.9", phase: 3, text: "Add background sync on app activate", file: "AppDelegate.swift", effort: 2, status: false, priority: "high", createdAt: Date.now() },
            { id: "3.10", phase: 3, text: "Add network change listener for auto-sync", file: "AppDelegate.swift", effort: 2, status: false, priority: "medium", createdAt: Date.now() },
            { id: "3.11", phase: 3, text: "Create sync status UI component", file: "New UI file", effort: 3, status: false, priority: "medium", createdAt: Date.now() },
            { id: "3.12", phase: 3, text: "Test offline â†’ online sync scenarios", file: "Testing", effort: 4, status: false, priority: "high", createdAt: Date.now() },
            // Phase 4
            { id: "4.1", phase: 4, text: "Debounce api_Get_PhlebDetails() calls", file: "MyAppointmentVC.swift", effort: 1, status: false, priority: "medium", createdAt: Date.now() },
            { id: "4.2", phase: 4, text: "Add 5-minute cache for phleb details", file: "MyAppointmentVC.swift", effort: 1, status: false, priority: "medium", createdAt: Date.now() },
            { id: "4.3", phase: 4, text: "Increase auto-refresh interval to 60 seconds", file: "MyAppointmentVC.swift", effort: 0.5, status: false, priority: "low", createdAt: Date.now() },
            { id: "4.4", phase: 4, text: "Skip refresh if last refresh < 30 seconds", file: "MyAppointmentVC.swift", effort: 1, status: false, priority: "low", createdAt: Date.now() },
            { id: "4.5", phase: 4, text: "Consolidate notification handlers", file: "MyAppointmentVC.swift", effort: 1, status: false, priority: "low", createdAt: Date.now() },
            { id: "4.6", phase: 4, text: "Remove redundant TokenManager calls", file: "BaseVC.swift", effort: 1, status: false, priority: "medium", createdAt: Date.now() },
            // Phase 5 (Backend)
            { id: "5.1", phase: 5, text: "Create /ping health check endpoint", file: "Backend", effort: 2, status: false, priority: "medium", createdAt: Date.now() },
            { id: "5.2", phase: 5, text: "Add X-Idempotency-Key header support", file: "Backend", effort: 8, status: false, priority: "high", createdAt: Date.now() },
            { id: "5.3", phase: 5, text: "Enable GZIP response compression", file: "Backend", effort: 2, status: false, priority: "low", createdAt: Date.now() },
            { id: "5.4", phase: 5, text: "Add request deduplication (5 sec window)", file: "Backend", effort: 4, status: false, priority: "high", createdAt: Date.now() },
            { id: "5.5", phase: 5, text: "Create bulk status update endpoint", file: "Backend", effort: 8, status: false, priority: "high", createdAt: Date.now() }
        ];

        // ===== NOTIFICATION SYSTEM =====
        const NOTIFICATIONS_KEY = 'myWorkNotifications';
        const LAST_VISIT_KEY = 'myWorkLastVisit';
        const WELCOME_SHOWN_KEY = 'myWorkWelcomeShown';
        
        let notifications = [];

        // Notification types and their icons/colors
        const notificationTypes = {
            welcome: { icon: 'sparkles', color: 'from-cyan-500 to-teal-500', title: 'Welcome' },
            tip: { icon: 'lightbulb', color: 'from-amber-500 to-orange-500', title: 'Tip' },
            update: { icon: 'arrow-up-circle', color: 'from-purple-500 to-pink-500', title: 'Update' },
            reminder: { icon: 'clock', color: 'from-blue-500 to-indigo-500', title: 'Reminder' },
            achievement: { icon: 'trophy', color: 'from-yellow-500 to-amber-500', title: 'Achievement' },
            info: { icon: 'info', color: 'from-slate-500 to-slate-600', title: 'Info' }
        };

        // Predefined tips to show randomly
        const tips = [
            { type: 'tip', message: 'Press "N" to quickly add a new task!' },
            { type: 'tip', message: 'Use Ctrl+K (or Cmd+K) to search tasks instantly.' },
            { type: 'tip', message: 'Your tasks are saved offline - no internet needed!' },
            { type: 'tip', message: 'Click on Phase Progress bars to filter tasks by phase.' },
            { type: 'tip', message: 'Toggle dark mode for comfortable night-time work.' },
            { type: 'tip', message: 'High priority tasks are shown at the top of the list.' },
            { type: 'tip', message: 'Use filters to focus on pending or completed tasks.' }
        ];

        // Announcements (you can update these for your team)
        const announcements = [
            { type: 'update', message: 'New feature: Dark mode is now available!', id: 'dark-mode-v1' },
            { type: 'update', message: 'You can now filter tasks by priority level.', id: 'priority-filter-v1' },
            { type: 'info', message: 'This tracker works offline - your data is safe!', id: 'offline-info-v1' }
        ];

        function initNotifications() {
            loadNotifications();
            checkFirstVisit();
            checkReturningUser();
            showStartupNotifications();
            updateNotificationBadge();
        }

        function loadNotifications() {
            const saved = localStorage.getItem(NOTIFICATIONS_KEY);
            if (saved) {
                notifications = JSON.parse(saved);
            }
        }

        function saveNotifications() {
            localStorage.setItem(NOTIFICATIONS_KEY, JSON.stringify(notifications));
            updateNotificationBadge();
        }

        function addNotification(type, message, persistent = false) {
            const notification = {
                id: 'notif_' + Date.now(),
                type: type,
                message: message,
                timestamp: Date.now(),
                read: false,
                persistent: persistent
            };
            notifications.unshift(notification);
            // Keep only last 20 notifications
            if (notifications.length > 20) {
                notifications = notifications.slice(0, 20);
            }
            saveNotifications();
            renderNotifications();
        }

        function checkFirstVisit() {
            const welcomeShown = localStorage.getItem(WELCOME_SHOWN_KEY);
            if (!welcomeShown) {
                // First time user - show welcome modal
                setTimeout(() => {
                    showWelcomeModal();
                }, 500);
                localStorage.setItem(WELCOME_SHOWN_KEY, 'true');
                
                // Add welcome notification
                addNotification('welcome', 'Welcome to myWork.AI Task Tracker! We\'re glad you\'re here.');
            }
        }

        function checkReturningUser() {
            const lastVisit = localStorage.getItem(LAST_VISIT_KEY);
            const now = Date.now();
            
            if (lastVisit) {
                const hoursSinceLastVisit = (now - parseInt(lastVisit)) / (1000 * 60 * 60);
                
                // If returning after more than 24 hours
                if (hoursSinceLastVisit > 24) {
                    const pendingTasks = state.tasks.filter(t => !t.status).length;
                    const completedTasks = state.tasks.filter(t => t.status).length;
                    
                    if (pendingTasks > 0) {
                        addNotification('reminder', `Welcome back! You have ${pendingTasks} pending task${pendingTasks > 1 ? 's' : ''} waiting.`);
                    } else if (completedTasks > 0) {
                        addNotification('achievement', 'Amazing! All your tasks are completed! ðŸŽ‰');
                    }
                }
                
                // Show a random tip occasionally (every 4+ hours)
                if (hoursSinceLastVisit > 4) {
                    const randomTip = tips[Math.floor(Math.random() * tips.length)];
                    setTimeout(() => {
                        addNotification(randomTip.type, randomTip.message);
                    }, 2000);
                }
            }
            
            localStorage.setItem(LAST_VISIT_KEY, now.toString());
        }

        function showStartupNotifications() {
            // Check for new announcements user hasn't seen
            const seenAnnouncements = JSON.parse(localStorage.getItem('myWorkSeenAnnouncements') || '[]');
            
            announcements.forEach(announcement => {
                if (!seenAnnouncements.includes(announcement.id)) {
                    addNotification(announcement.type, announcement.message);
                    seenAnnouncements.push(announcement.id);
                }
            });
            
            localStorage.setItem('myWorkSeenAnnouncements', JSON.stringify(seenAnnouncements));
            
            // Show greeting based on time of day
            const hour = new Date().getHours();
            let greeting = '';
            if (hour < 12) greeting = 'Good morning! Ready to be productive today?';
            else if (hour < 17) greeting = 'Good afternoon! Keep up the great work!';
            else if (hour < 21) greeting = 'Good evening! Wrapping up for the day?';
            else greeting = 'Working late? Remember to take breaks!';
            
            // Only show greeting if not first visit (welcome modal handles that)
            if (localStorage.getItem(WELCOME_SHOWN_KEY) === 'true' && !localStorage.getItem('greetingShown_' + new Date().toDateString())) {
                setTimeout(() => {
                    showToast(greeting, 'info');
                }, 1000);
                localStorage.setItem('greetingShown_' + new Date().toDateString(), 'true');
            }
        }

        function showWelcomeModal() {
            const content = document.getElementById('welcomeContent');
            const pendingCount = state.tasks.filter(t => !t.status).length;
            const totalHours = state.tasks.reduce((a, b) => a + b.effort, 0);
            
            content.innerHTML = `
                <div class="flex items-start gap-3 p-3 bg-cyan-50 dark:bg-cyan-900/20 rounded-xl">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-cyan-500 to-teal-500 flex items-center justify-center flex-shrink-0">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                    </div>
                    <div>
                        <h4 class="font-semibold text-slate-800 dark:text-white text-sm">${pendingCount} Tasks Ready</h4>
                        <p class="text-xs text-slate-500 dark:text-slate-400">${totalHours} hours of work loaded</p>
                    </div>
                </div>
                <div class="flex items-start gap-3 p-3 bg-amber-50 dark:bg-amber-900/20 rounded-xl">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-amber-500 to-orange-500 flex items-center justify-center flex-shrink-0">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                    </div>
                    <div>
                        <h4 class="font-semibold text-slate-800 dark:text-white text-sm">Works Offline</h4>
                        <p class="text-xs text-slate-500 dark:text-slate-400">Your data is saved locally</p>
                    </div>
                </div>
                <div class="flex items-start gap-3 p-3 bg-purple-50 dark:bg-purple-900/20 rounded-xl">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center flex-shrink-0">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <h4 class="font-semibold text-slate-800 dark:text-white text-sm">Dark Mode</h4>
                        <p class="text-xs text-slate-500 dark:text-slate-400">Toggle with the moon icon</p>
                    </div>
                </div>
            `;
            
            document.getElementById('welcomeModal').classList.remove('hidden');
        }

        function closeWelcomeModal() {
            document.getElementById('welcomeModal').classList.add('hidden');
        }

        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            const isHidden = panel.classList.contains('hidden');
            
            if (isHidden) {
                panel.classList.remove('hidden');
                renderNotifications();
                // Mark all as read after a delay
                setTimeout(() => {
                    markAllAsRead();
                }, 1000);
            } else {
                panel.classList.add('hidden');
            }
        }

        function renderNotifications() {
            const list = document.getElementById('notificationList');
            const noNotifs = document.getElementById('noNotifications');
            
            if (notifications.length === 0) {
                list.classList.add('hidden');
                noNotifs.classList.remove('hidden');
                return;
            }
            
            list.classList.remove('hidden');
            noNotifs.classList.add('hidden');
            
            list.innerHTML = notifications.map((notif, index) => {
                const typeInfo = notificationTypes[notif.type] || notificationTypes.info;
                const timeAgo = getTimeAgo(notif.timestamp);
                
                return `
                    <div class="notification-item p-4 border-b border-slate-100 dark:border-slate-700 last:border-0 ${notif.read ? 'opacity-60' : ''} hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors">
                        <div class="flex gap-3">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-r ${typeInfo.color} flex items-center justify-center flex-shrink-0">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    ${getNotificationIcon(notif.type)}
                                </svg>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-xs font-bold text-slate-600 dark:text-slate-300 uppercase">${typeInfo.title}</span>
                                    ${!notif.read ? '<span class="w-2 h-2 rounded-full bg-cyan-500"></span>' : ''}
                                </div>
                                <p class="text-sm text-slate-700 dark:text-slate-300">${escapeHtml(notif.message)}</p>
                                <p class="text-[10px] text-slate-400 mt-1">${timeAgo}</p>
                            </div>
                            <button onclick="dismissNotification('${notif.id}')" class="p-1 hover:bg-slate-200 dark:hover:bg-slate-600 rounded transition-colors flex-shrink-0">
                                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getNotificationIcon(type) {
            const icons = {
                welcome: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>',
                tip: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>',
                update: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 11l3-3m0 0l3 3m-3-3v8m0-13a9 9 0 110 18 9 9 0 010-18z"></path>',
                reminder: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>',
                achievement: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>',
                info: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>'
            };
            return icons[type] || icons.info;
        }

        function getTimeAgo(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            if (seconds < 60) return 'Just now';
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes}m ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}h ago`;
            const days = Math.floor(hours / 24);
            return `${days}d ago`;
        }

        function markAllAsRead() {
            notifications.forEach(n => n.read = true);
            saveNotifications();
            renderNotifications();
        }

        function dismissNotification(id) {
            notifications = notifications.filter(n => n.id !== id);
            saveNotifications();
            renderNotifications();
        }

        function clearAllNotifications() {
            notifications = [];
            saveNotifications();
            renderNotifications();
            showToast('All notifications cleared', 'info');
        }

        function updateNotificationBadge() {
            const unreadCount = notifications.filter(n => !n.read).length;
            const badges = ['notificationBadgeDesktop', 'notificationBadgeMobile'];
            
            badges.forEach(id => {
                const badge = document.getElementById(id);
                if (badge) {
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                }
            });
        }

        // Close notification panel when clicking outside
        document.addEventListener('click', (e) => {
            const panel = document.getElementById('notificationPanel');
            const bellDesktop = document.getElementById('notificationBellDesktop');
            const bellMobile = document.getElementById('notificationBellMobile');
            
            if (!panel.contains(e.target) && e.target !== bellDesktop && e.target !== bellMobile && 
                !bellDesktop?.contains(e.target) && !bellMobile?.contains(e.target)) {
                panel.classList.add('hidden');
            }
        });

        // ===== INITIALIZATION =====
        window.onload = () => {
            loadTheme();
            loadTasks();
            renderTasks();
            renderPhaseProgress();
            updateStats();
            initChart();
            setupNetworkListeners();
            setupKeyboardShortcuts();
            initNotifications();
        };

        // ===== THEME MANAGEMENT =====
        function loadTheme() {
            const savedTheme = localStorage.getItem(THEME_KEY);
            if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            }
        }

        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            localStorage.setItem(THEME_KEY, isDark ? 'dark' : 'light');
            
            // Update chart colors
            if (chartInstance) {
                chartInstance.destroy();
                initChart();
            }
            
            showToast(isDark ? 'Dark mode enabled' : 'Light mode enabled', 'info');
        }

        // ===== NETWORK STATUS =====
        function setupNetworkListeners() {
            updateOnlineStatus();
            window.addEventListener('online', () => {
                updateOnlineStatus();
                showToast('Back online! Your changes are saved.', 'success');
            });
            window.addEventListener('offline', () => {
                updateOnlineStatus();
                showToast('You are offline. Changes will sync when back online.', 'warning');
            });
        }

        function updateOnlineStatus() {
            const isOnline = navigator.onLine;
            const statusElements = ['onlineStatus', 'onlineStatusMobile'];
            
            statusElements.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    if (isOnline) {
                        el.className = 'flex items-center gap-1.5 px-2 lg:px-3 py-1 lg:py-1.5 rounded-full text-[10px] font-bold uppercase bg-emerald-500/20 text-emerald-400';
                        el.innerHTML = '<span class="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"></span><span>Online</span>';
                    } else {
                        el.className = 'flex items-center gap-1.5 px-2 lg:px-3 py-1 lg:py-1.5 rounded-full text-[10px] font-bold uppercase bg-amber-500/20 text-amber-400';
                        el.innerHTML = '<span class="w-1.5 h-1.5 rounded-full bg-amber-400"></span><span>Offline</span>';
                    }
                }
            });
        }

        // ===== KEYBOARD SHORTCUTS =====
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl/Cmd + K: Focus search
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    document.getElementById('searchInput').focus();
                }
                // N: New task (when not in input)
                if (e.key === 'n' && !['INPUT', 'TEXTAREA', 'SELECT'].includes(document.activeElement.tagName)) {
                    e.preventDefault();
                    openAddModal();
                }
                // Escape: Close modals
                if (e.key === 'Escape') {
                    closeModal();
                    closeDeleteModal();
                }
            });
        }

        // ===== DATA PERSISTENCE =====
        function loadTasks() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                state.tasks = JSON.parse(saved);
            } else {
                state.tasks = defaultTasks;
                saveTasks();
            }
        }

        function saveTasks() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state.tasks));
        }

        // ===== TASK CRUD OPERATIONS =====
        function generateId() {
            return 'task_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function addTask(taskData) {
            const newTask = {
                id: generateId(),
                text: taskData.text,
                phase: parseInt(taskData.phase),
                file: taskData.file || '',
                effort: parseFloat(taskData.effort),
                priority: taskData.priority,
                status: false,
                createdAt: Date.now(),
                updatedAt: Date.now()
            };
            state.tasks.unshift(newTask);
            saveTasks();
            showToast('Task added successfully', 'success');
        }

        function updateTask(id, taskData) {
            const index = state.tasks.findIndex(t => t.id === id);
            if (index !== -1) {
                state.tasks[index] = {
                    ...state.tasks[index],
                    text: taskData.text,
                    phase: parseInt(taskData.phase),
                    file: taskData.file || '',
                    effort: parseFloat(taskData.effort),
                    priority: taskData.priority,
                    updatedAt: Date.now()
                };
                saveTasks();
                showToast('Task updated successfully', 'success');
            }
        }

        function deleteTask(id) {
            state.tasks = state.tasks.filter(t => t.id !== id);
            saveTasks();
            showToast('Task deleted', 'info');
        }

        function toggleTask(id) {
            const task = state.tasks.find(t => t.id === id);
            if (task) {
                task.status = !task.status;
                task.updatedAt = Date.now();
                saveTasks();
                renderTasks();
                renderPhaseProgress();
                updateStats();
            }
        }

        // ===== MODAL MANAGEMENT =====
        function openAddModal() {
            state.editingTaskId = null;
            document.getElementById('modalTitle').textContent = 'Add New Task';
            document.getElementById('taskForm').reset();
            document.getElementById('taskId').value = '';
            document.getElementById('taskModal').classList.remove('hidden');
            document.getElementById('taskText').focus();
        }

        function openEditModal(id) {
            const task = state.tasks.find(t => t.id === id);
            if (!task) return;
            
            state.editingTaskId = id;
            document.getElementById('modalTitle').textContent = 'Edit Task';
            document.getElementById('taskId').value = id;
            document.getElementById('taskText').value = task.text;
            document.getElementById('taskPhase').value = task.phase;
            document.getElementById('taskPriority').value = task.priority || 'medium';
            document.getElementById('taskFile').value = task.file || '';
            document.getElementById('taskEffort').value = task.effort;
            document.getElementById('taskModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('taskModal').classList.add('hidden');
            state.editingTaskId = null;
        }

        function handleTaskSubmit(e) {
            e.preventDefault();
            
            const taskData = {
                text: document.getElementById('taskText').value.trim(),
                phase: document.getElementById('taskPhase').value,
                priority: document.getElementById('taskPriority').value,
                file: document.getElementById('taskFile').value.trim(),
                effort: document.getElementById('taskEffort').value
            };

            if (state.editingTaskId) {
                updateTask(state.editingTaskId, taskData);
            } else {
                addTask(taskData);
            }

            closeModal();
            renderTasks();
            renderPhaseProgress();
            updateStats();
            updateChart();
        }

        function openDeleteModal(id) {
            state.deleteTaskId = id;
            document.getElementById('deleteModal').classList.remove('hidden');
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.add('hidden');
            state.deleteTaskId = null;
        }

        function confirmDelete() {
            if (state.deleteTaskId) {
                deleteTask(state.deleteTaskId);
                closeDeleteModal();
                renderTasks();
                renderPhaseProgress();
                updateStats();
                updateChart();
            }
        }

        // ===== FILTERING & SEARCH =====
        function handleSearch(value) {
            state.filters.search = value.toLowerCase();
            renderTasks();
        }

        function applyFilters() {
            state.filters.status = document.getElementById('filterStatus').value;
            state.filters.priority = document.getElementById('filterPriority').value;
            renderTasks();
        }

        function clearFilters() {
            state.filters = { search: '', status: 'all', priority: 'all', phase: 'all' };
            document.getElementById('searchInput').value = '';
            document.getElementById('filterStatus').value = 'all';
            document.getElementById('filterPriority').value = 'all';
            renderTasks();
        }

        function switchPhase(phase) {
            state.activePhase = phase;
            
            // Update tab styles
            document.querySelectorAll('.phase-tab').forEach(tab => {
                const tabPhase = tab.dataset.phase;
                if (tabPhase == phase) {
                    tab.className = 'phase-tab px-4 py-2 rounded-xl bg-gradient-to-r from-cyan-500 to-teal-500 text-white font-semibold text-sm shadow-lg shadow-cyan-500/25 transition-all';
                } else {
                    tab.className = 'phase-tab px-4 py-2 rounded-xl bg-white/80 dark:bg-slate-800/80 text-slate-600 dark:text-slate-300 font-semibold text-sm border border-slate-200 dark:border-slate-700 hover:bg-cyan-50 dark:hover:bg-slate-700 hover:border-cyan-300 dark:hover:border-cyan-700 transition-all';
                }
            });
            
            renderTasks();
        }

        function getFilteredTasks() {
            let filtered = [...state.tasks];

            // Phase filter
            if (state.activePhase !== 'all') {
                filtered = filtered.filter(t => t.phase == state.activePhase);
            }

            // Search filter
            if (state.filters.search) {
                filtered = filtered.filter(t => 
                    t.text.toLowerCase().includes(state.filters.search) ||
                    (t.file && t.file.toLowerCase().includes(state.filters.search))
                );
            }

            // Status filter
            if (state.filters.status !== 'all') {
                filtered = filtered.filter(t => 
                    state.filters.status === 'completed' ? t.status : !t.status
                );
            }

            // Priority filter
            if (state.filters.priority !== 'all') {
                filtered = filtered.filter(t => t.priority === state.filters.priority);
            }

            // Sort by phase, then priority, then status
            const priorityOrder = { high: 0, medium: 1, low: 2 };
            filtered.sort((a, b) => {
                if (a.status !== b.status) return a.status ? 1 : -1;
                if (a.phase !== b.phase) return a.phase - b.phase;
                return (priorityOrder[a.priority] || 1) - (priorityOrder[b.priority] || 1);
            });

            return filtered;
        }

        // ===== RENDERING =====
        function renderTasks() {
            const container = document.getElementById('taskContainer');
            const emptyState = document.getElementById('emptyState');
            const filtered = getFilteredTasks();

            if (filtered.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                emptyState.classList.add('flex');
                return;
            }

            emptyState.classList.add('hidden');
            emptyState.classList.remove('flex');

            container.innerHTML = filtered.map(task => {
                const priorityClass = `priority-${task.priority || 'medium'}`;
                const priorityColors = {
                    high: 'bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-400',
                    medium: 'bg-amber-100 text-amber-700 dark:bg-amber-900/50 dark:text-amber-400',
                    low: 'bg-cyan-100 text-cyan-700 dark:bg-cyan-900/50 dark:text-cyan-400'
                };

                return `
                    <div class="phase-card ${priorityClass} bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm p-4 rounded-xl border border-slate-200/50 dark:border-slate-700/50 shadow-sm ${task.status ? 'opacity-60' : ''}">
                        <div class="flex items-start gap-3">
                            <button onclick="toggleTask('${task.id}')" class="flex-shrink-0 mt-0.5 ${task.status ? 'text-teal-500' : 'text-slate-300 dark:text-slate-600 hover:text-cyan-400'}">
                                <svg class="w-6 h-6" fill="${task.status ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24">
                                    ${task.status 
                                        ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>'
                                        : '<circle cx="12" cy="12" r="9" stroke-width="2"></circle>'
                                    }
                                </svg>
                            </button>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-start justify-between gap-2">
                                    <h4 class="font-semibold text-slate-800 dark:text-slate-200 text-sm ${task.status ? 'line-through text-slate-400 dark:text-slate-500' : ''}">${escapeHtml(task.text)}</h4>
                                    <div class="flex items-center gap-1 flex-shrink-0">
                                        <button onclick="openEditModal('${task.id}')" class="p-1.5 hover:bg-cyan-50 dark:hover:bg-slate-700 rounded-lg transition-colors" title="Edit">
                                            <svg class="w-4 h-4 text-slate-400 hover:text-cyan-600 dark:hover:text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                        </button>
                                        <button onclick="openDeleteModal('${task.id}')" class="p-1.5 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors" title="Delete">
                                            <svg class="w-4 h-4 text-slate-400 hover:text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="flex flex-wrap items-center gap-2 mt-2">
                                    <span class="text-[10px] bg-gradient-to-r from-cyan-100 to-teal-100 dark:from-cyan-900/50 dark:to-teal-900/50 text-cyan-700 dark:text-cyan-400 font-bold px-2 py-0.5 rounded uppercase">Phase ${task.phase}</span>
                                    <span class="text-[10px] ${priorityColors[task.priority || 'medium']} font-bold px-2 py-0.5 rounded uppercase">${task.priority || 'medium'}</span>
                                    ${task.file ? `<span class="text-[10px] text-slate-400 dark:text-slate-500 font-mono truncate max-w-[150px]">${escapeHtml(task.file)}</span>` : ''}
                                </div>
                            </div>
                            <div class="flex-shrink-0 text-right">
                                <div class="text-sm font-bold text-cyan-600 dark:text-cyan-400">${task.effort}h</div>
                                <div class="text-[9px] text-slate-400 uppercase">effort</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderPhaseProgress() {
            const list = document.getElementById('phaseProgressList');
            let html = '';
            
            for (let i = 1; i <= 5; i++) {
                const phaseTasks = state.tasks.filter(t => t.phase === i);
                const completed = phaseTasks.filter(t => t.status).length;
                const total = phaseTasks.length;
                const percent = total > 0 ? Math.round((completed / total) * 100) : 0;
                
                html += `
                    <div class="cursor-pointer hover:bg-cyan-50 dark:hover:bg-slate-700/50 p-2 -mx-2 rounded-lg transition-colors" onclick="switchPhase(${i})">
                        <div class="flex justify-between text-xs font-bold mb-1">
                            <span class="text-slate-600 dark:text-slate-400">Phase ${i}</span>
                            <span class="text-cyan-600 dark:text-cyan-400">${completed}/${total}</span>
                        </div>
                        <div class="w-full bg-slate-100 dark:bg-slate-700 h-2 rounded-full overflow-hidden">
                            <div class="bg-gradient-to-r from-cyan-500 to-teal-500 h-full transition-all duration-500" style="width: ${percent}%"></div>
                        </div>
                    </div>
                `;
            }
            list.innerHTML = html;
        }

        function updateStats() {
            const completedEffort = state.tasks.filter(t => t.status).reduce((acc, curr) => acc + curr.effort, 0);
            const totalEffort = state.tasks.reduce((acc, curr) => acc + curr.effort, 0);
            const remaining = totalEffort - completedEffort;
            const percentTotal = totalEffort > 0 ? Math.round((completedEffort / totalEffort) * 100) : 0;

            document.getElementById('totalProgressText').textContent = percentTotal + '%';
            document.getElementById('totalHoursText').textContent = remaining.toFixed(1);
            document.getElementById('totalProgressTextMobile').textContent = percentTotal + '%';
            document.getElementById('totalHoursTextMobile').textContent = remaining.toFixed(1);
        }

        // ===== CHART =====
        function initChart() {
            const ctx = document.getElementById('effortChart').getContext('2d');
            const isDark = document.documentElement.classList.contains('dark');
            
            const phaseEfforts = [1, 2, 3, 4, 5].map(p => 
                state.tasks.filter(t => t.phase === p).reduce((a, b) => a + b.effort, 0)
            );

            // Brand colors matching myWork app
            const brandColors = ['#0ea5e9', '#06b6d4', '#14b8a6', '#0d9488', '#0891b2'];

            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Phase 1', 'Phase 2', 'Phase 3', 'Phase 4', 'Phase 5'],
                    datasets: [{
                        data: phaseEfforts,
                        backgroundColor: brandColors,
                        borderWidth: 0,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: { 
                            position: 'bottom', 
                            labels: { 
                                boxWidth: 10, 
                                font: { size: 10, weight: 'bold' },
                                color: isDark ? '#94a3b8' : '#64748b'
                            } 
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => ` ${context.label}: ${context.raw} hrs`
                            }
                        }
                    }
                }
            });
        }

        function updateChart() {
            if (!chartInstance) return;
            
            const phaseEfforts = [1, 2, 3, 4, 5].map(p => 
                state.tasks.filter(t => t.phase === p).reduce((a, b) => a + b.effort, 0)
            );
            
            chartInstance.data.datasets[0].data = phaseEfforts;
            chartInstance.update();
        }

        // ===== TOAST NOTIFICATIONS =====
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            
            const colors = {
                success: 'bg-gradient-to-r from-teal-500 to-emerald-500',
                error: 'bg-gradient-to-r from-red-500 to-rose-500',
                warning: 'bg-gradient-to-r from-amber-500 to-orange-500',
                info: 'bg-gradient-to-r from-cyan-500 to-teal-500'
            };

            const icons = {
                success: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>',
                error: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>',
                warning: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>',
                info: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>'
            };

            toast.className = `toast-enter flex items-center gap-3 px-4 py-3 ${colors[type]} text-white rounded-xl shadow-lg`;
            toast.innerHTML = `
                <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">${icons[type]}</svg>
                <span class="text-sm font-medium">${escapeHtml(message)}</span>
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.remove('toast-enter');
                toast.classList.add('toast-exit');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ===== UTILITIES =====
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
